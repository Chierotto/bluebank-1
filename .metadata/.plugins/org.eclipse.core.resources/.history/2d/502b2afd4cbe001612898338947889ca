package bluebank.jdbc.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import bluebank.jdbc.ConnectionFactory;
import bluebank.jdbc.modelo.Conta;

public class ContaDao {
	
	private Connection connection;
	   
	public ContaDao() {
	  this.connection = new ConnectionFactory().getConnection();
	}	

	public int ExisteConta(Conta conta){
		try{
			PreparedStatement stmt = this.connection.
	                 prepareStatement("select count(1) existe from conta where agencia = ? and conta = ?");
		    
			stmt.setLong(1,conta.getAgencia());
		    stmt.setLong(2,conta.getConta());
				
			ResultSet rs = stmt.executeQuery();
			
			return rs.getInt("existe"); 
			
			
			
		}catch (Exception e) {
			throw new RuntimeException(e);
		}	
		
	}
	
	
	public void BuscaSaldo(Conta conta){
		
		try{
			PreparedStatement stmt = this.connection.
	                 prepareStatement("select saldo from conta where agencia = ? and conta = ?");
			
	       stmt.setLong(1,conta.getAgencia());
	       stmt.setLong(2,conta.getConta());
			
			ResultSet rs = stmt.executeQuery();
			
			double saldo = rs.getDouble("saldo");
			
			conta.setSaldo(saldo);  			
			
		}catch (Exception e) {
			throw new RuntimeException(e);
		}	
				
	}
	
	public void AlteraSaldo(Conta conta){
		try{
			PreparedStatement stmt = this.connection.
	                 prepareStatement("update saldo = ? from conta where agencia = ? and conta = ?");
			
		   stmt.setDouble(1,conta.getSaldo());	
	       stmt.setLong(2,conta.getAgencia());
	       stmt.setLong(3,conta.getConta());
			
		   stmt.execute();
		   stmt.close();	  			
			
		}catch (Exception e) {
			throw new RuntimeException(e);
		}	
	}
	
}
